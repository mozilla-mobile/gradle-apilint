/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

plugins {
    id 'java-gradle-plugin'
    id 'groovy'
    id 'maven-publish'
}

sourceSets {
    main {
        java {
            srcDirs 'src'
            srcDirs '../buildSrc'
        }
    }
}

group 'org.mozilla.android'
version '0.1'

buildDir "${topobjdir}/apilint"

gradlePlugin {
    plugins {
        apilint {
            id = 'org.mozilla.apilint'
            implementationClass = 'org.mozilla.apilint.ApiLintPlugin'
        }
    }
}

task testApiLint(type: Exec) {
    workingDir '.'
    commandLine 'python', 'src/test/resources/apilint_test.py'
}

test.dependsOn testApiLint

// Tests that the expected doclet result is understood by apilint.py
task integrationTestApiLint(type: Exec) {
    workingDir '.'
    commandLine 'python', 'src/main/resources/apilint.py',
         '../apidoc-plugin/src/test/resources/expected-doclet-output.txt',
         '../apidoc-plugin/src/test/resources/expected-doclet-output.txt'
}

test.dependsOn integrationTestApiLint

apply plugin: 'java'

dependencies {
    compile gradleApi()
    compile localGroovy()
}
